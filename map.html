<!doctype html>
<html lang="en">
<head>
    <title>AID Projects</title>

    <style>
        body{
            margin: 0px;
        }
        p{
            font-size:13px;
        }
        #map-canvas {
            width:60%;
            height:100%;
            float:right;
            margin-top: 0px;
        }
        #sidebar #page{
            width: 40%;
            height: 650px;
            float: right;
            margin-top: 0px;
            background-color:#FFFFFF;
        }
        #marker_list{
            margin-left: auto;
            margin-right: auto;
            margin-top: 10px;
            width:100%; 
            font-family:Verdana, sans-serif; 
            font-size:16px;
            list-style: none;
        }
        #marker_list #projectname{
            font-size:16px;
            color:#000000; 
            background-color:#FFFFFF;
            line-height:20px;
            border-bottom-style:solid; 
            border-bottom-width:1px; 
            border-bottom-color:#CCCCCC; 
            padding-left:10px; 
            padding-right:10px;
            cursor:pointer;
            text-decoration:none;
        }
        #marker_list #projectname:hover{
            border-bottom-style:solid; 
            border-bottom-width:1px; 
            border-bottom-color:#000000; 
        }
        #marker_list #url{
            font-family:Verdana, sans-serif; 
            font-size:12px;
            color: #1031d4;
        }
        #marker_list li {
            color:#000000; 
            background-color:#FFFFFF;
            line-height:15px;
            border-bottom-style:solid; 
            border-bottom-width:1px; 
            border-bottom-color:#CCCCCC; 
            padding-left:10px; 
            padding-top: 10px;
            cursor:pointer;
        }
        #marker_list a li:hover{
            background-color:#dfdddd;
        }
    </style>

    <!-- CSS -->
    <link rel="stylesheet" href="css/themes/jquery.mobile-1.4.5.css" />
    <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
    <!-- <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" /> -->
    
    <!-- jQuery -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.0/jquery.mobile-1.3.0.min.js" type="text/javascript"></script>
    <!-- <script src="/js/jquery.js" type="text/javascript"></script> -->
    
    <!-- Google Maps -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3&sensor=false&language=en"> </script>
    <script type="text/javascript"
    src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"> </script>
    <script type="text/javascript"
    src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox_packed.js"> </script>
    <script type="text/javascript">

    var cityList = [
        ["RTI Manch", "http://projects.anuyantra.com/project/rti-manch", "rajasthan", "jaipur", [26.5727, 73.839]], 
        ["Dam Awareness Project in Uttarakhand ", "http://projects.anuyantra.com/project/dam-awareness-project-uttarakhand", "uttarakhand", "uttarkashi", [30.33, 78.06]], 
        ["Jaagriti - an awakening", "http://projects.anuyantra.com/project/jaagriti-awakening", "national-capital-territory-delhi", "south-west-delhi", [28.61, 77.23]], 
        ["Joyful Education & Holistic Development Of 300 Disadvantaged Slum Childrens In 8 Slums Of Patna", "http://projects.anuyantra.com/project/joyful-education-holistic-development-300-disadvantaged-slum-childrens-8-slums-patna", "bihar", "patna", [25.37, 85.13]], 
        ["Sathi - Cehat", "http://projects.anuyantra.com/project/sathi-cehat", "madhya-pradesh", "barwani", [23.25, 77.417]], 
        ["Protection of Amrit Mahal Kavals of Challakere Taluk", "http://projects.anuyantra.com/project/protection-amrit-mahal-kavals-challakere-taluk", "karnataka", "chitradurga", [12.9702, 77.5603]], 
        ["Mainstreaming Gender Perspectives in Various Institutions", "http://projects.anuyantra.com/project/mainstreaming-gender-perspectives-various-institutions", "gujarat", "ahmedabad", [23.2167, 72.6833]], 
        ["Sustainable Organic Farming in Sunderbans (with BTS)", "http://projects.anuyantra.com/project/sustainable-organic-farming-sunderbans-bts", "west-bengal", "south-24-parganas", [22.5667, 88.3667]], 
        ["Deepa Academy", "http://projects.anuyantra.com/project/deepa-academy", "karnataka", "bangalore-rural", [12.9702, 77.5603]], 
        ["ARTRC", "http://projects.anuyantra.com/project/artrc", "odisha", "khordha", [20.15, 85.5]]
    ];

    var indiaCenter = new google.maps.LatLng(21, 77.7200);
    var boxList =[];
    var side_bar_link = ""; 
    var gmarkers = []; 

    function initialize() {

        //create map
        map = new google.maps.Map(document.getElementById('map-canvas'), {
            zoom: 5,
            center: indiaCenter
        });

        // //create layer for India
        // var layer = new google.maps.FusionTablesLayer({
        //     query: {
        //         select: 'geometry',
        //         from: '420419',
        //         where : "name_0 = 'India'"
        //     },
        //     styles: [{
        //         polygonOptions: {
        //             fillColor: "#FFFFFF",
        //             fillOpacity: -1.0,
        //             strokeColor: "#C0C0C0",
        //             strokeWeight: .5
        //           }
        //     }],
        //     map: map
        // });

        //add markers for each project
        addMarkers();


        //create button to reset map to broadest useful view
        var homeControlDiv = document.createElement('div');
        var homeControl = new HomeControl(homeControlDiv, map);

        homeControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.TOP_RIGHT].push(homeControlDiv);

        //make sidebar lnks
        document.getElementById("marker_list").innerHTML = side_bar_link;
    }

    //function to open infobox and zoom map on sidebar link click
    function myclick(i) {
        //close all other infoboxes
        for ( h = 0; h < boxList.length; h++ ) {
                boxList[h].close();
            }

        //open appropriate infobox
        google.maps.event.trigger(gmarkers[i], "mouseover");
        

        //reset center and zoom
        map.setCenter(gmarkers[i].getPosition());
        map.setZoom(6);
    }

    //add markers, infoboxes for each location
    function addMarkers(){
        for (var i = 0; i < cityList.length; i++)
        {
            //add markers
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(cityList[i][4][0], cityList[i][4][1]),
                map: map,
                id: i,
                title: cityList[i][0],
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillOpacity: 0.5,
                    fillColor: '#00b0e6',
                    strokeOpacity: 1.0,
                    strokeColor: '#00b0e6',
                    strokeWeight: 2.0, 
                    scale: 10 //pixels
                }
            });     
            gmarkers.push(marker);    

            //create textbox
            var boxText = document.createElement("div");
            boxText.id = i;
            boxText.style.cssText = "width: 150px; border: 1px solid gray; margin-top: 8px; background: white; padding:10px; font-family:Verdana, sans-serif; font-size: 14px;";
            boxText.innerHTML = '<b>'+cityList[i][0]+'</b><br><p>Click for more</p>';

            //set infobox style options
            var myOptions = {
                content: boxText
                ,disableAutoPan: false
                ,maxWidth: 0
                ,pixelOffset: new google.maps.Size(-140, 0)
                ,zIndex: null
                ,boxStyle: {
                    width: "280px"
                }
                ,closeBoxMargin: "10px 2px 2px 2px"
                ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
                ,infoBoxClearance: new google.maps.Size(1, 1)
                ,isHidden: false
                ,pane: "floatPane"
                ,enableEventPropagation: false
            };

            //create infobox and add to list of all infoboxes
            var ib = new InfoBox(myOptions);
            boxList.push(ib);

            //open infoboxes on mouseover
            google.maps.event.addListener(marker,'mouseover',(function(marker, i) {
                return function() {
                    boxList[i].open(map, this);
                }
            })(marker, i));
            //close infoboxes on mouseout
            google.maps.event.addListener(marker,'mouseout',(function(marker, i) {
                return function() {
                    boxList[i].close(map, this);
                }
            })(marker, i));

            //respnose to click on marker
            google.maps.event.addDomListener(marker,'click',(function(marker, i) {
                    return function() {
                      alert('Will eventually in-depth sidebar details for ' + cityList[i][0])
                    }
                  })(marker, i));

            side_bar_link += '<li><b><a id="projectname" href="javascript:myclick(' + (gmarkers.length-1) + ')">' + cityList[i][0] + '<\/a></b><br><p>' + createInfoWindowContent(cityList[i]) +'<p></li>';
        }
    }

    //build a button to reset map entirely to view of India
    function HomeControl(controlDiv, map) {

        // Set CSS styles for the DIV containing the control
        // Setting padding to 5 px will offset the control
        // from the edge of the map
        controlDiv.style.padding = '5px';

        // Set CSS for the control border
        var controlUI = document.createElement('div');
        controlUI.style.backgroundColor = 'white';
        controlUI.style.borderStyle = 'solid';
        controlUI.style.borderWidth = '1px';
        controlUI.style.cursor = 'pointer';
        controlUI.style.textAlign = 'center';
        controlUI.title = 'Click to set the map to all India';
        controlDiv.appendChild(controlUI);

        // Set CSS for the control interior
        var controlText = document.createElement('div');
        controlText.style.fontFamily = 'Arial,sans-serif';
        controlText.style.fontSize = '12px';
        controlText.style.paddingLeft = '4px';
        controlText.style.paddingRight = '4px';
        controlText.innerHTML = '<b>Show All India</b>';
        controlUI.appendChild(controlText);

        // Setup the click event listeners: show all of India
        google.maps.event.addDomListener(controlUI, 'click', function() {
        
            //zoom out and center
            map.setZoom(5)
            map.setCenter(indiaCenter)

            //close all infoboxes
            for ( h = 0; h < boxList.length; h++ ) {
                boxList[h].close();
            }
        });
      }

      //helper function to create content window for each project
        function createInfoWindowContent(project) {
            return [
              'State: ' + capitaliseFirstLetter(project[2]),
              'District: ' + capitaliseFirstLetter(project[3]),
              'Description:',
              '<a id="url" href='+project[1]+'>Visit project page<\/a>'
            ].join('<br>');
        }

        //capitalization
        function capitaliseFirstLetter(string)
        {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>
</head>

<body onload="initialize()">
    <div id="map-canvas"></div>
    <div id = "sidebar">
        <div data-role="page" id="page">
          <div data-role="content">
            <ul id="marker_list" data-filter="true" data-role="listview" data-filter-placeholder="Search projects"></ul>
          </div>
        </div>
    </div>
    
</body>

</html>